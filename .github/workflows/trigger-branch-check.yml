name: '[test] Comment Trigger Branch Check'

on:
  issue_comment:
    types: [ created ]

jobs:
  test-branch-check:
    if: github.event.issue.pull_request != null && startsWith(github.event.comment.body, 'update-v4-schema')
    runs-on: ubuntu-24.04
    permissions:
      contents: read
      pull-requests: write

    steps:
      - name: Post result comment
        uses: actions/github-script@v7
        with:
          script: |
            const branchName = context.payload.issue.pull_request.head.ref;
            const prJson = context.payload.issue.pull_request;

            const message = `
✅ ブランチ名の検証結果：

- head.ref から取得したブランチ名: \`${branchName}\`
- pull_request 全体の内容:
\\\`\\\`\\\`json
${JSON.stringify(prJson, null, 2)}
\\\`\\\`\\\`
`;

            await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: message
            });